<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>
    <title>COMP3121 RONNX.W PAGE</title>
    <meta charset="UTF-8">
    <meta name="description" content="RON.W, G.N, K.C, COMP3121">
    <meta name="keywords" content="RON.W, G.N, K.C">
    <meta name="author" content="RON.W, G.N, K.C">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137384879-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-137384879-1');
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <!-- <script src="./Scripts/lib/underscore-min_1.9.1.js"></script> -->
    <!-- <script async defer src="https://connect.facebook.net/en_US/sdk.js"></script> -->

    <script>
        function loopFBposts(page_id, access_token) {
            FB.api(
                "/" + page_id + "/feed"
                , 'get',
                {
                    fields: "permalink_url",
                    access_token: access_token
                },
                function (response) {
                    console.log(response);
                    $.each(response.data, function (seq, value) {
                        var div = $("<div/>").attr({ "data-href": value.permalink_url, "data-width": 180, "data-height": 150 })
                            .addClass("fb-post");
                        $("#content-farm").append(div);
                    })
                    if (response && !response.error) {
                        /* handle the result */
                    }
                }
            );
        }
        function getIGposts(user_id, access_token) {
            var access_token = access_token || '12480168229.1677ed0.04b2ebbd6f3d4ad19c587046e1cebd79';
            var user_id = user_id || '12480168229';
            var ig_icon = $("<img/>").attr("src", "ig_icon.png").addClass("footer_icon");
            var footer = $("<div/>").append(ig_icon).addClass("footer");
            $.ajax({
                url: 'https://api.instagram.com/v1/users/' + user_id + '/media/recent/',
                data: { 'access_token': access_token },
                success: function (response) {
                    $.each(response.data, function (seq, value) {
                        var img = $("<img/>").attr("src", value.images.low_resolution.url);
                        var createdAt = $("<span/>").text("Posted " + value.created_time);
                        var caption = "";
                        if (value.caption) {
                            caption = $("<div/>").text(value.caption.text).addClass("div_caption");
                        }
                        var inner_footer = footer.clone().append(createdAt);
                        var div = $("<div/>").append(img, caption, inner_footer).addClass("post_container");
                        $("#content-farm").append(div);
                        console.log(timeDifference(Date.now() - value.created_time));
                    })
                    console.log(response);

                    // $.getScript("//www.instagram.com/embed.js", function (data, textStatus, jqxhr) {
                    //     $.each(response.data, function (seq, value) {
                    //         var url = value.link + "?utm_source=ig_embed&amp;utm_medium=loading";
                    //         var jobj = $("<blockquote/>").addClass("instagram-media").attr({"data-instgrm-permalink":url})
                    //         console.log(url);

                    //         $("#content-farm").append(jobj);
                    //         // console.log(timeDifference(Date.now() - value.created_time));
                    //     })
                    //     console.log(response);
                    // })
                },
                dataType: 'json'
            });
        }
        function test() {
            // $.ajax({
            //         url: 'https://www.flickr.com/services/oauth/request_token',
            //         method: 'POST',
            //         data:{                     
            //             oauth_nonce: 89601180,
            //             oauth_timestamp: 1305583298,
            //             oauth_consumer_key: '653e7a6ecc1d528c516cc8f92cf98611',
            //             oauth_signature_method: 'HMAC-SHA1',
            //             oauth_version: 1.0,
            //             oauth_callback: 'https://www.instagram.com/developer/endpoints/users/'
            //         },
            //         beforeSend: function(xhr) {
            //             xhr.setRequestHeader("Authorization", "Bearer 6QXNMEMFHNY4FJ5ELNFMP5KRW52WFXN5");
            //             xhr.setRequestHeader('Access-Control-Allow-Origin', '*')
            //             xhr.setRequestHeader('Access-Control-Request-Method', '*');
            //             xhr.setRequestHeader('Access-Control-Allow-Methods', 'OPTIONS, GET, PUT, PATCH, DELETE');
            //             xhr.setRequestHeader('Access-Control-Allow-Headers', 'authorization, content-type');
            //         }, success: function(data){
            //             alert(data);
            //             //process the JSON data etc
            //         },failed: function(){
            //             console.log("FA");
            //         }
            // })
            $.ajax({
                url: "https://api.tumblr.com/v2/blog/blog.tumblr.com/info?api_key=dXwvMlyqgyy000m7vWRXDOQBXDBlhE52aJVgApiUGH4A1bHJkI",
                dataType: 'jsonp',
                success: function (info) {
                    console.log(info);
                    // Print Title On the Page
                }
            });
        }

        function getflickrPhoto(api_key, user_id) {
            //getflickrPhoto('07f5406aa61661dd1a9fa441aeb74739', '170802717%40N06')
            var api_key = api_key || '07f5406aa61661dd1a9fa441aeb74739';
            var user_id = user_id || '170802717@N06';
            var ig_icon = $("<img/>").attr("src", "flickr.png").addClass("footer_icon");
            var footer = $("<div/>").append(ig_icon).addClass("footer");
            $.ajax({
                url: "https://api.flickr.com/services/rest/?method=flickr.people.getPublicPhotos&api_key=" + api_key + "&user_id=" + user_id + "&format=json&nojsoncallback=1",
                dataType: 'json',
                success: function (response) {
                    console.log(response);
                    if (response && response.stat == 'ok');
                    {
                        $.getScript("https://embedr.flickr.com/assets/client-code.js", function (data, textStatus, jqxhr) {
                            $.each(response.photos.photo, function (seq, value) {
                                var photo_id = value.id;
                                var photo_url = "https://api.flickr.com/services/rest/?method=flickr.photos.getInfo&api_key=" + api_key + "&photo_id=" + photo_id + "&format=json&nojsoncallback=1";
                                //https://api.flickr.com/services/rest/?method=flickr.photos.getInfo&api_key=07f5406aa61661dd1a9fa441aeb74739&photo_id=33678366578&format=rest
                                $.ajax({
                                    url: photo_url,
                                    dataType: 'json',
                                    success: function (data) {
                                        console.log(data);
                                        if (data && data.stat == 'ok') {
                                            var post_url = data.photo.urls.url[0]._content + "in/dateposted-public/";
                                            var img_url = "https://live.staticflickr.com/" + data.photo.server + "/" + photo_id + "_" + data.photo.secret + "_n.jpg";
                                            //https://www.flickr.com/photos/170802717@N06/40589961393/in/dateposted-public/
                                            var jobj = $("<a/>").attr({"data-flickr-embed":"true", "data-header":"true", "data-footer":"true", "href" : post_url});
                                            var imgobj = $("<img/>").attr({"src" :img_url}).width(320).height(180);
                                            $("#content-farm").append(jobj.append(imgobj));

                                            // console.log(data);
                                            // var img_url = "https://live.staticflickr.com/" + data.photo.server + "/" + photo_id + "_" + data.photo.secret + "_z.jpg";
                                            // var img = $("<img/>").attr("src", img_url).css({ "width": "325px" });
                                            // var createdAt = $("<span/>").text("Posted " + data.photo.dateuploaded);
                                            // var inner_footer = footer.clone().append(createdAt);
                                            // var caption = "";
                                            // if (data.photo.description._content) {
                                            //     caption = $("<div/>").text(data.photo.description._content).addClass("div_caption");
                                            // }
                                            // var div = $("<div/>").append(img, caption, inner_footer).addClass("post_container");
                                            // $("#content-farm").append(div);
                                        }
                                        // Print Title On the Page
                                    }
                                });
                            })
                        })
                    }
                    // Print Title On the Page
                }
            });
        }

        function getYoutubeList(channel_id, key) {
            var channel_id = channel_id || 'UCXer80GTQcPPs4E1HcjFS2g';
            var key = key || 'AIzaSyBO_huHjsv757yzeRa0gdWxHLLejU5Kro0';
            $.when(getYoutubeChannel.call(this, channel_id, key)).done(function(response){
                $.each(response.items, function (seq, playlist) {
                    $.when(getYoutubePlayListVideos.call(this, playlist.contentDetails.relatedPlaylists.uploads, key)).done(function (videoList) {
                        $.each(videoList.items, function (seq, data) {
                            console.log(data);
                            var url = "https://www.youtube.com/embed/" + data.contentDetails.videoId;
                            var video = $("<embed/>").width(500).height(300).attr({"src":url});
                            $("#content-farm").append(video);
                        })
                    })
                })
            })
            // $.ajax({
            //     url: "https://www.googleapis.com/youtube/v3/channels",
            //     data: { part: "contentDetails"
            //     ,id: channel_id
            //     , key: key},
            //     dataType: 'json',
            //     success: function (response) {
            //         $.each(response.items, function(seq, playlist){
			// 			console.log(playlist.id)
            //         })
            //     }
            // })
        }
        function getYoutubeChannel(channel_id, key){
            return $.ajax({
                url: "https://www.googleapis.com/youtube/v3/channels",
                data: { part: "contentDetails"
                ,id: channel_id
                , key: key},
                dataType: 'json'
            })
        }

        function getYoutubePlayListVideos(playlistId, key){
            return $.ajax({
                url: "https://www.googleapis.com/youtube/v3/playlistItems",
                data: { part: "contentDetails"
                ,playlistId: playlistId
                , key: key},
                dataType: 'json'
            })
        }

        function getTumblrs(api_key){//getTumblrs.call(this, 'dXwvMlyqgyy000m7vWRXDOQBXDBlhE52aJVgApiUGH4A1bHJkI')
            var api_key = api_key || 'dXwvMlyqgyy000m7vWRXDOQBXDBlhE52aJVgApiUGH4A1bHJkI';
            $.ajax({
                url: "https://api.tumblr.com/v2/blog/black-dd0101.tumblr.com/posts/",
                data: {
                    api_key: api_key},
                dataType: 'json',
                success: function(response){
                    console.log(response);
                    if(response.meta.status == 200){
                        $.getScript( "https://assets.tumblr.com/post.js", function( data, textStatus, jqxhr ) {
                            $.each(response.response.posts, function (seq, post) {
                                var embed_url = "https://embed.tumblr.com/embed/post/a3SqPf00rL1mpKmJpjfwrA/" + post.id;
                                console.log(embed_url);
                                var div = $("<div/>").attr({ "data-href": embed_url }).addClass("tumblr-post").css({width:"300px", "display": "inline-block"});
                                console.log(div);

                                $("#content-farm").append(div);
                            })
                        });
                    }
                    $(".tumblr-embed").css("display", "inline-block");
                }
            })
        }

        function parseParms(str) {
            var pieces = str.split("&"), data = {}, i, parts;
            // process each query pair
            for (i = 0; i < pieces.length; i++) {
                parts = pieces[i].split("=");
                if (parts.length < 2) {
                    parts.push("");
                }
                data[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1]);
            }
            return data;
        }
        function timeDifference(date) {
            var dateFromAPI = "2016-02-10T00:00:00Z";
            var now = new Date();
            var datefromAPITimeStamp = (new Date(dateFromAPI)).getTime();
            var nowTimeStamp = now.getTime();
            var microSecondsDiff = Math.abs(datefromAPITimeStamp - nowTimeStamp);
            // Number of milliseconds per day =
            //   24 hrs/day * 60 minutes/hour * 60 seconds/minute * 1000 msecs/second
            var daysDiff = Math.floor(microSecondsDiff / (1000 * 60 * 60 * 24));
        }
        $(document).ready(function () {
            console.log("AA");
            var queryString = window.location.search.slice(1);
            if (queryString) {
                qString = queryString.split('q=')[1].split('&')[0];
                console.log(qString);
            }
            $(".tumblr-embed").css("display", "inline-block");
            // getIGposts.call(this, "12480168229", "12480168229.1677ed0.04b2ebbd6f3d4ad19c587046e1cebd79");
            // getflickrPhoto.call(this, '07f5406aa61661dd1a9fa441aeb74739', '170802717%40N06');
            // getYoutubeList.call(this, 'UCXer80GTQcPPs4E1HcjFS2g', 'AIzaSyBO_huHjsv757yzeRa0gdWxHLLejU5Kro0')

            // test.call(this);
            console.log(parseParms(document.location.hash.substring(1)));
        });	
    </script>
    <style>
        .post_container {
            border: 1px solid grey;
            width: 350px;
            text-align: center;
            padding-top: 15px;
            display: inline-block;
        }

        .footer {
            background-color: lightblue;
            vertical-align: middle;
            line-height: 25px;
            height: 25px;
            text-align: left;
            display: flex;
            margin-top: 15px;
        }

        .footer_icon {
            position: relative;
            width: 25px;
            margin-left: 10px;
        }

        .div_caption {
            text-align: left;
            margin: 5px 15px -10px 15px;
        }

        .farm_container {
            display: inline-block;
        }
    </style>
</head>

<body>
    <div id="content-farm" class="farm_container"></div>
        <!-- <div id="fb-postfarm" class="farm_container"></div>
        <div id="ig-postfarm" class="farm_container"></div>
        <div id="flickr-postfarm" class="farm_container"></div> -->
    <!-- <div class="fb-page" data-href="https://www.facebook.com/facebook" data-tabs="timeline" data-small-header="false"
        data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true">
        <blockquote cite="https://www.facebook.com/facebook" class="fb-xfbml-parse-ignore"><a
                href="https://www.facebook.com/facebook">Facebook</a></blockquote>
    </div> -->
</body>
<script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2&appId=333396590622882&autoLogAppEvents=1"></script>
<script>
    function FBInit() {//https://graph.facebook.com/v3.2/121839578966030/feed?fields=permalink_url&access_token=333396590622882|zEw0UcZtz6nbkDKNV02VqGfQzS0
        window.fbAsyncInit = function () {
            FB.init({
                appId: '333396590622882',
                xfbml: true,
                version: 'v3.2'
            });
            // FB.AppEvents.logPageView();
            loopFBposts.call(this, "121839578966030", "333396590622882|zEw0UcZtz6nbkDKNV02VqGfQzS0");
            getflickrPhoto.call(this, '07f5406aa61661dd1a9fa441aeb74739', '170802717%40N06');
            getIGposts.call(this, "12480168229", "12480168229.1677ed0.04b2ebbd6f3d4ad19c587046e1cebd79");
            getYoutubeList.call(this, 'UCXer80GTQcPPs4E1HcjFS2g', 'AIzaSyBO_huHjsv757yzeRa0gdWxHLLejU5Kro0');
            getTumblrs.call(this, 'dXwvMlyqgyy000m7vWRXDOQBXDBlhE52aJVgApiUGH4A1bHJkI');

        };
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    }
    FBInit();
</script>
<!-- <script src="https://embedr.flickr.com/assets/client-code.js" charset="utf-8"></script> -->
<!-- <script src="https://assets.tumblr.com/post.js"></script> -->
<script async src="//www.instagram.com/embed.js"></script>
</html>
