<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>
    <title>COMP3121 RONNX.W PAGE</title>
    <meta charset="UTF-8">
    <meta name="description" content="RON.W, G.N, K.C, COMP3121">
    <meta name="keywords" content="RON.W, G.N, K.C">
    <meta name="author" content="RON.W, G.N, K.C">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-137384879-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-137384879-1');
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <!-- <script src="./Scripts/lib/underscore-min_1.9.1.js"></script> -->
    <!-- <script async defer src="https://connect.facebook.net/en_US/sdk.js"></script> -->

    <script>
        var _class_profile_name = "profile_name";
        var _class_profile_picture = "profile_picture";
        var _class_profile_username = "profile_username";
        var _class_profile_info = "profile_info";
        var _class_social_icon = "social_icon";
        function loopFBposts(page_id, access_token) {
            FB.api(
                "/" + page_id + "/feed"
                , 'get',
                {
                    fields: "permalink_url",
                    access_token: access_token
                },
                function (response) {
                    console.log(response);
                    $.each(response.data, function (seq, value) {
                        /*var divPostImg = renderPostIMGContainer.call(this, value.images.low_resolution.url, value.link);
                        var post_info = render_post_info.call(this, value.user.profile_picture, value.user.full_name, value.user.username, value.created_time * 1000, "Instagram")
                        var caption = "";
                        if (value.caption) {
                            caption = $("<div/>").text(value.caption.text).addClass("post-content");
                        }*/
                        var div = $("<div/>").attr({ "data-href": value.permalink_url, "data-width": 300, "data-height": 200 })
                            .addClass("fb-post");
                        var divContainer = $("<div/>").append(div).addClass("post-container");
                        $("#content-farm").append(divContainer);

                        /*var div = $("<div/>").attr({ "data-href": value.permalink_url, "data-width": 180, "data-height": 150 })
                            .addClass("fb-post");
                        $("#content-farm").append(div);*/
                    })
                    if (response && !response.error) {
                        /* handle the result */
                    }
                }
            );
        }
        function findTag(jobj_caption, caption) {
            caption = caption.trim().replace(/(\r\n|\n|\r)/gm, "");;
            var arrCaption = caption.split("#");
            if (arrCaption.length > 1) {
                arrCaption = arrCaption.filter(function (d) { return d != "" })
                arrCaption = _.map(arrCaption, function (value) {
                    return value.split(" ")[0];
                });
            }
        }
        function render_post_info(profile_picture, profile_name, profile_username, createdAt, social_type) {
            var jobj_profile_picture = '';
            var profile_name = $("<div/>").text(profile_name).addClass(_class_profile_name);
            var jobj_profile_username = $("<div/>").text("@" + profile_username).addClass(_class_profile_username);
            var createDatetime = '';//$("<div/>").text("Created At " + new Date(createdAt * 1000));
            var dateago = $("<div/>").text(timeDifference.call(this, createdAt));
            var social_icon = "";
            switch (social_type) {
                case "Instagram":
                    social_icon = $("<a/>")
                        .attr({ "href": "https://www.instagram.com/", "target": "_blank" })
                        .append($("<img/>").attr("src", "./images/instagram.png").addClass(_class_social_icon));
                    jobj_profile_picture = $("<a/>")
                        .attr({ "href": "https://www.instagram.com/" + profile_username, "target": "_blank" })
                        .append($("<img/>").attr("src", profile_picture).addClass(_class_profile_picture));
                    break;
                case "Youtube":
                    social_icon = $("<a/>")
                        .attr({ "href": "https://www.youtube.com/", "target": "_blank" })
                        .append($("<img/>").attr("src", "./images/youtube.png").addClass(_class_social_icon));
                    jobj_profile_picture = $("<a/>")
                        .attr({ "href": "https://www.youtube.com/channel/" + profile_username, "target": "_blank" })
                        .append($("<img/>").attr("src", profile_picture).addClass(_class_profile_picture));
                    break;
                case "Tumblr":
                    social_icon = $("<a/>")
                        .attr({ "href": "https://www.tumblr.com/", "target": "_blank" })
                        .append($("<img/>").attr("src", "./images/tumblr-logo.png").addClass(_class_social_icon));
                    jobj_profile_picture = $("<a/>")
                        .attr({ "href": "https://" + profile_username + ".tumblr.com/", "target": "_blank" })
                        .append($("<img/>").attr("src", profile_picture).addClass(_class_profile_picture));
                    break;
                case "Flickr":
                    social_icon = $("<a/>")
                        .attr({ "href": "https://www.flickr.com/", "target": "_blank" })
                        .append($("<img/>").attr("src", "./images/flickr.png").addClass(_class_social_icon));
                    jobj_profile_picture = $("<a/>")
                        .attr({ "href": "https://www.flickr.com/photos/" + profile_username + "/", "target": "_blank" })
                        .append($("<img/>").attr("src", profile_picture).addClass(_class_profile_picture));
                    break;
                default: break;
            }
            var profile_info = $("<div/>").append(jobj_profile_username, profile_name, createDatetime, dateago).addClass(_class_profile_info);
            var post_info = $("<div/>").addClass("post_info")
                .append(jobj_profile_picture, profile_info, social_icon);
            return post_info;
        }
        function getIGposts(user_id, access_token) {
            var access_token = access_token || '12480168229.1677ed0.04b2ebbd6f3d4ad19c587046e1cebd79';
            var user_id = user_id || '12480168229';
            $.ajax({
                url: 'https://api.instagram.com/v1/users/' + user_id + '/media/recent/',
                data: { 'access_token': access_token },
                success: function (response) {
                    $.each(response.data, function (seq, value) {
                        var divPostImg = renderPostIMGContainer.call(this, value.images.low_resolution.url, value.link);
                        var post_info = render_post_info.call(this, value.user.profile_picture, value.user.full_name, value.user.username, value.created_time * 1000, "Instagram")
                        var caption = "";
                        if (value.caption) {
                            caption = $("<div/>").text(value.caption.text).addClass("post-content");
                        }
                        var div = $("<div/>").append(divPostImg, post_info, caption).addClass("post-container");
                        $("#content-farm").append(div);
                    })
                },
                dataType: 'json'
            });
        }
        function getflickrPhoto(api_key, user_id) {
            //getflickrPhoto('07f5406aa61661dd1a9fa441aeb74739', '170802717%40N06')
            var api_key = api_key || '07f5406aa61661dd1a9fa441aeb74739';
            var user_id = user_id || '170802717@N06';
            $.ajax({
                url: "https://api.flickr.com/services/rest/?method=flickr.people.getPublicPhotos&api_key=" + api_key + "&user_id=" + user_id + "&format=json&nojsoncallback=1",
                dataType: 'json',
                success: function (response) {
                    var userInfo = getflickrUserInfo.call(this, api_key, user_id);
                    console.log(userInfo);
                    if (response && response.stat == 'ok');
                    {
                        $.each(response.photos.photo, function (seq, value) {
                            var photo_id = value.id;
                            var photo_url = "https://api.flickr.com/services/rest/?method=flickr.photos.getInfo&api_key=" + api_key + "&photo_id=" + photo_id + "&format=json&nojsoncallback=1";
                            $.ajax({
                                url: photo_url,
                                dataType: 'json',
                                success: function (data) {
                                    console.log(data);
                                    if (data && data.stat == 'ok') {
                                        var img_url = "https://live.staticflickr.com/" + data.photo.server + "/" + photo_id + "_" + data.photo.secret + "_z.jpg";
                                        var divPostImg = renderPostIMGContainer.call(this, img_url, data.photo.urls.url[0]._content);
                                        var post_info = render_post_info.call(this, "https://s.yimg.com/pw/images/buddyicon05_r.png#170802717@N06",
                                            data.photo.owner.realname, data.photo.owner.nsid, data.photo.dateuploaded * 1000, "Flickr")
                                        var caption = "";
                                        if (data.photo.description) {
                                            caption = $("<div/>").text(data.photo.description._content).addClass("post-content");
                                        }
                                        var div = $("<div/>").append(divPostImg, post_info, caption).addClass("post-container");
                                        $("#content-farm").append(div);
                                    }
                                    // Print Title On the Page
                                }
                            });
                        })
                    }
                    // Print Title On the Page
                }
            });
        }
        function getflickrUserInfo(api_key, user_id) {
            return $.ajax({
                url: "https://api.flickr.com/services/rest/?method=flickr.people.getInfo&api_key=" + api_key + "&user_id=" + user_id + "&format=json&nojsoncallback=1",
                method: "GET",
                dataType: 'jsonp'
            })
        }
        function getYoutubeList(channel_id, key) {
            var channel_id = channel_id || 'UCXer80GTQcPPs4E1HcjFS2g';
            var key = key || 'AIzaSyBO_huHjsv757yzeRa0gdWxHLLejU5Kro0';
            $.when(getYoutubeChannel.call(this, channel_id, key)).done(function (response) {
                $.each(response.items, function (seq, playlist) {
                    $.when(getYoutubePlayListVideos.call(this, playlist.contentDetails.relatedPlaylists.uploads, key)).done(function (videoList) {
                        $.each(videoList.items, function (seq, data) {
                            var url = "https://www.youtube.com/embed/" + data.contentDetails.videoId;
                            var video = $("<embed/>").width(300).height(300).attr({ "src": url });
                            $("#content-farm").append(video);
                            var post_info = render_post_info.call(this, playlist.snippet.thumbnails.medium.url, data.snippet.channelTitle,
                                data.snippet.channelId, new Date(data.contentDetails.videoPublishedAt).getTime(), "Youtube");
                            var caption = "";
                            if (data.snippet.description != '') {
                                caption = $("<div/>").text(data.snippet.description).addClass("post-content");
                            }
                            var div = $("<div/>").append(video, post_info, caption).addClass("post-container youtube");
                            $("#content-farm").append(div);
                        })
                    })
                })
            })
        }
        function getYoutubeChannel(channel_id, key) {
            return $.ajax({
                url: "https://www.googleapis.com/youtube/v3/channels",
                data: {
                    part: "snippet, contentDetails"
                    , id: channel_id
                    , key: key
                },
                dataType: 'json'
            })
        }
        function getYoutubePlayListVideos(playlistId, key) {
            return $.ajax({
                url: "https://www.googleapis.com/youtube/v3/playlistItems",
                data: {
                    part: "snippet, contentDetails"
                    , playlistId: playlistId
                    , key: key
                },
                dataType: 'json'
            })
        }
        function getTumblr(api_key) {//getTumblr.call(this, 'dXwvMlyqgyy000m7vWRXDOQBXDBlhE52aJVgApiUGH4A1bHJkI')
            var api_key = api_key || 'dXwvMlyqgyy000m7vWRXDOQBXDBlhE52aJVgApiUGH4A1bHJkI';
            $.ajax({
                url: "https://api.tumblr.com/v2/blog/black-dd0101.tumblr.com/posts/",
                data: {
                    api_key: api_key
                },
                dataType: 'json',
                success: function (response) {
                    if (response.meta.status == 200) {
                        $.each(response.response.posts, function (seq, post) {
                            var img_post = '', a_img_post = '', divPostImg = $("<div>").addClass("postImg-container");
                            if (post.type == "photo") {
                                divPostImg = renderPostIMGContainer.call(this, post.photos[0].alt_sizes[4].url, post.post_url);
                            }
                            var post_info = render_post_info.call(this, "https://assets.tumblr.com/images/default_avatar/octahedron_open_128.png",
                                post.blog_name, post.blog_name, new Date(post.date).getTime(), "Tumblr")
                            var caption = "";
                            if (post.summary) {
                                caption = $("<div/>").html(post.summary).addClass("post-content");
                            }
                            var div = $("<div/>").append(divPostImg, post_info, caption).addClass("post-container");
                            $("#content-farm").append(div);
                        })
                    }
                    $(".tumblr-embed").css("display", "inline-block");
                }
            })
        }
        function renderPostIMGContainer(photo_url, post_url) {
            var img_post = $("<img/>").attr("src", photo_url).addClass("img_post");
            var a_img_post = $("<a/>").attr({ "href": post_url, "target": "_blank" }).append(img_post);
            var div = $("<div/>").append(a_img_post).addClass("postImg-container");
            return div;
        }
        function parseParms(str) {
            var pieces = str.split("&"), data = {}, i, parts;
            // process each query pair
            for (i = 0; i < pieces.length; i++) {
                parts = pieces[i].split("=");
                if (parts.length < 2) {
                    parts.push("");
                }
                data[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1]);
            }
            return data;
        }
        function timeDifference(date) {
            var dateDiff = new Date() - date;
            var weeksDiff = Math.floor(dateDiff / 1000 / 60 / 60 / 24 / 7) || 0;
            var daysDiff = Math.floor(dateDiff / 1000 / 60 / 60 / 24) || 0;
            var hoursDiff = Math.floor(dateDiff / 1000 / 60 / 60) || 0;
            var minsDiff = Math.floor(dateDiff / 1000 / 60) || 0;
            if (weeksDiff != 0) {
                return "Posted " + weeksDiff + " weeks ago";
            }
            else if (daysDiff != 0) {
                return "Posted " + daysDiff + " days ago";
            }
            else if (hoursDiff != 0) {
                return "Posted " + hoursDiff + " hrs ago";
            }
            else {
                return "Posted " + minsDiff + " hrs ago";
            }
        }
        $(document).ready(function () {
            console.log("AA");
            var queryString = window.location.search.slice(1);
            if (queryString) {
                qString = queryString.split('q=')[1].split('&')[0];
                console.log(qString);
            }
            $(".tumblr-embed").css("display", "inline-block");
            // getIGposts.call(this, "12480168229", "12480168229.1677ed0.04b2ebbd6f3d4ad19c587046e1cebd79");
            // getflickrPhoto.call(this, '07f5406aa61661dd1a9fa441aeb74739', '170802717%40N06');
            // getYoutubeList.call(this, 'UCXer80GTQcPPs4E1HcjFS2g', 'AIzaSyBO_huHjsv757yzeRa0gdWxHLLejU5Kro0')
            // test.call(this);
            getflickrPhoto.call(this, '07f5406aa61661dd1a9fa441aeb74739', '170802717%40N06');
            getIGposts.call(this, "12480168229", "12480168229.1677ed0.04b2ebbd6f3d4ad19c587046e1cebd79");
            getYoutubeList.call(this, 'UCXer80GTQcPPs4E1HcjFS2g', 'AIzaSyBO_huHjsv757yzeRa0gdWxHLLejU5Kro0');
            getTumblr.call(this, 'dXwvMlyqgyy000m7vWRXDOQBXDBlhE52aJVgApiUGH4A1bHJkI');            
            console.log(parseParms(document.location.hash.substring(1)));
        });	
    </script>
    <style>
        .postImg-container {
            min-height: 100px;
        }
        .post-container {
            background-color: white;
            border: 1px solid grey;
            /* text-align: center; */
            margin: 15px;
            border-radius: 10px;
            max-width: 300px;
            width: 300px;
        }
        .post-container.youtube {
            border-radius: unset;
        }
        img.profile_picture {
            border-radius: 100%;
            width: 50px;
            height: 50px;
            vertical-align: top;
            cursor: pointer;
        }
        .post_info {
            margin: 10px;
            min-height: 60px;
            border-bottom: 2px solid grey;
        }
        .profile_info {
            display: inline-block;
            margin-left: 10px;
        }
        img.img_post {
            border-radius: 10px;
            width: 100%;
            max-width: 320px;
        }
        .footer {
            background-color: lightblue;
            vertical-align: middle;
            line-height: 25px;
            height: 25px;
            text-align: left;
            display: flex;
            margin-top: 15px;
        }
        .footer_icon {
            position: relative;
            width: 25px;
            margin-left: 10px;
        }
        .post-content {
            min-height: 20px;
            text-align: left;
            padding: 10px;
            /* margin: 5px 15px -10px 15px; */
        }
        .farm_container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
        }
        .profile_name {
            font-size: 12px;
            color: grey;
            padding: 3px;
        }
        .social_icon {
            width: 35px;
            float: right;
            cursor: pointer;
        }
        body{
            background-image: url('./images/background3.jpg');
        }
    </style>
</head>

<body>
    <div id="content-farm" class="farm_container"></div>
    <!-- <div id="fb-postfarm" class="farm_container"></div>
        <div id="ig-postfarm" class="farm_container"></div>
        <div id="flickr-postfarm" class="farm_container"></div> -->
    <!-- <div class="fb-page" data-href="https://www.facebook.com/facebook" data-tabs="timeline" data-small-header="false"
        data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true">
        <blockquote cite="https://www.facebook.com/facebook" class="fb-xfbml-parse-ignore"><a
                href="https://www.facebook.com/facebook">Facebook</a></blockquote>
    </div> -->
</body>
<script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2&appId=333396590622882&autoLogAppEvents=1"></script>
<script>
    function FBInit() {//https://graph.facebook.com/v3.2/121839578966030/feed?fields=permalink_url&access_token=333396590622882|zEw0UcZtz6nbkDKNV02VqGfQzS0
        window.fbAsyncInit = function () {
            FB.init({
                appId: '333396590622882',
                xfbml: true,
                version: 'v3.2'
            });
            // FB.AppEvents.logPageView();
            //loopFBposts.call(this, "121839578966030", "333396590622882|zEw0UcZtz6nbkDKNV02VqGfQzS0");
        };
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) { return; }
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    }
    FBInit();
</script>
<!-- <script src="https://embedr.flickr.com/assets/client-code.js" charset="utf-8"></script> -->
<!-- <script src="https://assets.tumblr.com/post.js"></script> -->
<script async src="//www.instagram.com/embed.js"></script>

</html>
